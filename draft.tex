
\section{Terminologie}

abonnement
message \pie
voisins


\section{Algorithme réparti et protocole}

\subsection{Identifiants}

\paragraph{N\oe uds}

L'identifiant d'un n\oe ud est défini à l'origine par le fournisseur du produit \airplug~: c'est lui qui s'assure de leur unicité.


\paragraph{Messages}

L'identifiant d'un message est défini par le \timestamp\ correspondant  à la date de sa rédaction.


\subsection{Annonce de l'état d'un n\oe ud}

Chaque n\oe ud annonce à ses voisins, à un intervalle de temps régulier, les messages \pie\ qu'il a à offrir, ainsi que les abonnements qu'il demande.

Les offres et les demandes sont annoncées indépendamment. En effet, cette solution donne l'avantage de choisir plus finement les intervalles de temps pour chaque type d'annonce.


\subsubsection{Définition des annonces d'offre de messages}

Un n\oe ud annonce en priorité ses propres messages qu'il a à offrir. Dans une certaine limite, il annonce également les messages que ses voisins offrent de leur c\^oté.

Les messages offerts par les voisins sont pondérés avec la distance au n\oe ud courant, en nombre de sauts. En effet, les messages offerts par le n\oe ud courant sont pondérés à 0, tandis que les messages offerts par les voisins voient leur pondération d'origine incrémentée de 1.

Par exemple, les messages d'un voisin direct \texttt{A} ont une pondération de 1, alors que les messages de \texttt{B}, voisin direct de \textsf{A} en ont une de 2. Dans le cas où \texttt{B} est à la fois un voisin direct de \textsf{A} et du n\oe ud courant, la pondération la plus petite est conservée, soit 0.

\format{IDNOEUD/ANNONCEOFFRE/MSG,MSG,MSG,\ldots}

\formatvar{MSG}{PONDERATION-IDNOEUD-IDMSG}


\subsubsection{Définition des annonces d'abonnements}

Un n\oe ud annonce en priorité ses propres abonnements. Dans une certaine limite, il annonce également les abonnements de ses voisins les plus proches.

Les abonnements sont pondérés aux aussi par la distance au n\oe ud courant, en nombre de sauts. En effet, les abonnements du n\oe ud courant sont pondérés à 0, tandis que ceux des voisins voient leur pondération d'origine incrémentée de 1.

\format{IDNOEUD/ANNONCEABO/ABO,ABO,ABO,\ldots}

\formatvar{ABO}{PONDERATION-IDNOEUD}


\subsection{Envoi à la demande de messages}

Quand un n\oe ud \texttt{D} se rend compte qu'un voisin \texttt{A} annonce son abonnement à \texttt{B}, et qu'un message de \texttt{B} est offert par un voisin \texttt{C} avec une pondération de 0, alors il fait une demande du contenu de ce message à \texttt{C}.

\format{IDNOEUD/DEMANDE/IDNOEUD-IDMSG}

Quand \texttt{C} reçoit la demande, il répond en envoyant le message concerné.

\format{IDNOEUD/ENVOI/IDMSG/CONTENUMSG}

Le n\oe ud \texttt{D} reçoit alors le message, le sauve dans sa mémoire, et peut donc annoncer qu'il peut l'offrir avec une pondération de 0. Ainsi, le n\oe ud \texttt{A} peut dorénavant récupérer le message écrit par \texttt{B} via une demande à \texttt{D}, alors que \texttt{A} et \texttt{B} ne peuvent pas communiquer de façon directe.

